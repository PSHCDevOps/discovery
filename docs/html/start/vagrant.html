

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Discovery on Vagrant &mdash; GSA Discovery 3.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Discovery on Docker" href="docker.html" />
    <link rel="prev" title="Discovery development options" href="development.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GSA Discovery
          

          
            
            <img src="../_static/discovery.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Discovery overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="readme.html">Getting started with Discovery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="readme.html#overview">Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="readme.html#topics">Topics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="about.html">About Discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="development.html">Development options</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Running with Vagrant</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-virtual-machine">Running the virtual machine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-vagrant-commands">Common Vagrant commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-help">Getting help</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="docker.html">Discovery on Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="setup.html">Discovery setup</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Discovery development options</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Discovery on Vagrant</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vagrant-configurations">Vagrant configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-configurations">Application configurations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-virtual-machine">Running the virtual machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-vagrant-commands">Common Vagrant commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-help">Getting help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Discovery on Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Discovery setup</a></li>
</ul>
<p class="caption"><span class="caption-text">Architecture</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../architecture/readme.html">Architecture and design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/technologies.html">Discovery technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/design.html">Discovery system and frontend design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/data.html">Discovery data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/assets.html">Discovery static assets</a></li>
</ul>
<p class="caption"><span class="caption-text">Processes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/readme.html">Discovery processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/development.html">Discovery development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/testing.html">Discovery testing process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/deployment.html">Discovery deployment process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/management.html">Discovery management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/contributing.html">Contributing to Discovery</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GSA Discovery</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../readme.html">Discovery overview</a> &raquo;</li>
        
      <li>Discovery on Vagrant</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="discovery-on-vagrant">
<span id="discovery-on-vagrant"></span><h1>Discovery on Vagrant<a class="headerlink" href="#discovery-on-vagrant" title="Permalink to this headline">¶</a></h1>
<p><strong>&lt;</strong> <a class="reference internal" href="development.html"><span class="doc">Development options</span></a> | <strong>^</strong> <strong><a class="reference internal" href="readme.html"><span class="doc">Getting Started</span></a></strong> | <a class="reference internal" href="docker.html"><span class="doc">Discovery on Docker</span></a> <strong>&gt;</strong></p>
<p><br/></p>
<div class="section" id="installation">
<span id="installation"></span><h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Vagrant installation is very easy.  It requires two things; a Virtual Machine provider, and the Vagrant application.</p>
<p>Discovery comes packaged currently for Virtualbox so you will need to have Virtualbox installed.  See the Virtualbox install instructions below to install for your operating system.  They have an installer for most operating systems.</p>
<ul class="simple">
<li><strong>Virtualbox</strong> - Install Virtualbox from: <a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></li>
</ul>
<p>Vagrant is available as an executable installer for Windows, Mac, and Linux.</p>
<ul class="simple">
<li><strong>Vagrant</strong> - Install Vagrant from: <a class="reference external" href="https://www.vagrantup.com/downloads.html">https://www.vagrantup.com/downloads.html</a></li>
</ul>
<p><br/></p>
</div>
<div class="section" id="configuration">
<span id="configuration"></span><h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The Discovery Vagrantfile is meant to be configurable depending on the needs of the developer.  To keep everything that needs to be versioned, we use a pattern of a default Vagrant configuration file that can be overridden if an override exists.  All Vagrant related configurations are in the <strong>vagrant</strong> directory.</p>
<p>You will also need to ensure certain environment variables are set for the Discovery application containers.  We provide an example (<a class="reference external" href="https://github.com/PSHCDevOps/discovery/blob/master/docker/django-env.example.vars">docker/django-env.example.vars</a>) but you will need to create a file called <strong>docker/django-env.vars</strong> that has sensitive application information.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># If you using Git on Windows, make sure you selected &#39;Checkout as-is&#39; during setup. Then make sure that you run: git config --global  core.autocrlf false, so Git will not perform any conversions when checking out or committing text files.</span>


<span class="c1"># Fetch Discovery project</span>
$ git clone https://github.com/PSHCDevOps/discovery.git <span class="o">{</span>project_directory<span class="o">}</span>
$ <span class="nb">cd</span> <span class="o">{</span>project_directory<span class="o">}</span>

<span class="c1"># vagrant-config.yml is ignored by Git so your configurations will not be versioned</span>
$ cp vagrant/config.default.yml vagrant/config.yml

<span class="c1"># docker/django-env.vars is ignored by Git so your configuration will not be versioned</span>
$ cp docker/django-env.example.vars docker/django-env.vars
</pre></div>
</div>
<p><em>See the sections below for notes on the available configurations...</em></p>
<p><br/></p>
<div class="section" id="vagrant-configurations">
<span id="vagrant-configurations"></span><h3>Vagrant configurations<a class="headerlink" href="#vagrant-configurations" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><strong>server_name</strong> <em>default: discovery-dev</em></p>
<p>Sets the internal hostname of the virtual machine.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>ip_address</strong> <em>default: system assigned</em></p>
<p>Sets the host ip address by which the virtual machine can be reached.  If this is not set then the system automatically selects an available IP.  Set this if you need to ensure the virtual machine is listening at a particular address.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>box_name</strong> <em>default: ubuntu/trusty64</em></p>
<p>Sets the box or image to use from the <a class="reference external" href="https://app.vagrantup.com/boxes/search">Vagrant Cloud</a> marketplace.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>cpus</strong> <em>default: 2</em></p>
<p>Sets the number of virtual CPUs that should be used for the virtual machine.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>memory_size</strong> <em>default: 2048</em></p>
<p>Sets the memory allocation for the virtual machine.  You may need to increase this depending upon how you load data.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>web_port</strong> <em>default: 8080</em></p>
<p>Sets the host port for the Discovery web site.  By default this is 8080 and should not be changed unless you really need to and you know what you are doing.  Discovery Javascript receives an environment variable with the host and port to connect to fetch data from the API.  If these do not align then there can be issues with the front end display.</p>
<p>If this is changed, the <strong>API_HOST</strong> environment variable should also be updated in the <strong>docker/django-env.vars</strong> file covered below and in the <a class="reference internal" href="docker.html"><span class="doc">next section on Docker setup</span></a>.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>db_port</strong> <em>default: 5432</em></p>
<p>Sets the host port that the cluster PostgreSQL database is available.  This is handy for connecting with the Docker database from the host machine through a <a class="reference external" href="https://www.postgresql.org/docs/10/static/reference-client.html">client command</a> or through a graphical management interface like <a class="reference external" href="https://dbeaver.jkiss.org/">DBeaver</a></p>
</li>
</ul>
<ul>
<li><p class="first"><strong>queue_port</strong> <em>default: 6379</em></p>
<p>Sets the host port that the Redis queue is available.  This is handy if you already have tools for inspecting the queue on the host machine.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>copy_ssh</strong> <em>default: false</em></p>
<p>Whether or not to share the host user <strong>.ssh</strong> information (<em>except the authorized_hosts file</em>) with the Vagrant virtual machine.  This is handy if you want to be able to push to remote repositories requiring SSH keys.  If this is shared the Docker environment will share with all of the Django containers, giving you pass through push ability of protected repositories.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>copy_gitconfig</strong> <em>default: true</em></p>
<p>Whether or not to share the host user <strong>.gitconfig</strong> file with the Vagrant virtual machine.  This is handy if you want to be able to commit without resetting this information within the development environment.  If this is set, this file is shared with all Django containers giving you a consistent identity across the host, development machine, and application containers.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>copy_vimrc</strong> <em>default: false</em></p>
<p>Whether or not to share a host user VIM editor configuration with the Vagrant virtual machine.  This can be useful if you use VIM for inspecting files.  If this is set it is shared with all Django Docker containers.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>copy_profile</strong> <em>default: false</em></p>
<p>Whether or not to share the host user Bash <strong>.profile</strong> with the Vagrant machine.  This can allow you to align your environment more closely with your host environment if you use a Bash based shell (on a Mac or Linux).  If this is set it is shared with all Django Docker containers.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>copy_bash_aliases</strong> <em>default: false</em></p>
<p>Whether or not to share a host user Bash <strong>.bash_aliases</strong> file with the Vagrant machine if it exists.  Sometimes this file can define handy aliases sourced into the <strong>.bashrc</strong> so we give a chance to share with Vagrant and the Django containers as well.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>copy_bashrc</strong> <em>default: false</em></p>
<p>Whether or not to share the host user Bash <strong>.bashrc</strong> script with the Vagrant virtual machine.  This allows for a consistent environment across host, development machine, and application containers.</p>
<p>Note that the contents of the <a class="reference external" href="https://github.com/PSHCDevOps/discovery/blob/master/scripts/vagrant-bash.sh">scripts/vagrant-bash.sh</a> script are appended to any shared <strong>.bashrc</strong> or the default box provided one during the Vagrant provision process.</p>
</li>
</ul>
<p><br/></p>
</div>
<div class="section" id="application-configurations">
<span id="application-configurations"></span><h3>Application configurations<a class="headerlink" href="#application-configurations" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><strong>API_HOST</strong> <em>default: http://localhost:8080</em></p>
<p>Sets the API request location for the Discovery frontend. The Discovery application passes the host and port of the API interface to the frontend Javascript.  This enables the Javascript to make requests to the API which basically power the frontend displays.  If no data is loading in the interface, chances are that this value is wrong.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>SAM_API_KEY</strong> <em>default: <strong>REQUIRED!!!</strong></em></p>
<p>Sets the <a class="reference external" href="https://api.data.gov/signup/">Data.gov API key</a> that is passed to requests to get SAM vendor registration information.</p>
</li>
</ul>
<ul>
<li><p class="first"><strong>SECRET_KEY</strong> <em>default: <strong>REQUIRED!!!</strong></em></p>
<p>Sets a secret alpha-numeric key that is required by Django for certain operations.  This key can be anything you like but it should be lengthy and randomistic.</p>
</li>
<li><p class="first"><strong>GA_TRACKING_ID</strong> <em>default: <strong>None</strong></em></p>
<p>Sets a Google Analytics tracking id for the environment.  This is fed into the frontend HTML tracking snippet in the Discovery template.</p>
</li>
</ul>
<p><br/></p>
</div>
</div>
<div class="section" id="running-the-virtual-machine">
<span id="running-the-virtual-machine"></span><h2>Running the virtual machine<a class="headerlink" href="#running-the-virtual-machine" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">{</span>project directory<span class="o">}</span>

<span class="c1"># Start up and provision the Vagrant virtual machine using the packaged Vagrantfile</span>
$ vagrant up

<span class="c1"># SSH into the Vagrant virtual machine to start working with the application cluster</span>
$ vagrant ssh

<span class="c1"># Build frontend Angular application</span>
$ scripts/build-frontend.sh

<span class="c1"># Start Docker containers if they are not already running</span>
$ docker-compose up -d

<span class="c1"># Wait for database migration to complete (should see &quot;beat: Starting&quot;)</span>
$ docker-compose logs --follow scheduler

<span class="c1"># Load data fixtures if migration complete</span>
$ scripts/load-fixtures.sh
</pre></div>
</div>
<p>You are now in the shared project directory: <strong>/vagrant</strong></p>
<p>When the Vagrant machine is first created all Docker containers specified in the docker-compose configuration are created and started.  The Discovery application cluster consists of a <strong>Django web server</strong>, a <strong>Celery scheduler</strong>, <strong>Celery worker</strong>, <strong>PostgreSQL database</strong>, and a <strong>Redis queue</strong>.</p>
<ul class="simple">
<li><strong>/vagrant</strong> live at <strong>localhost:8080</strong> (<em>if you didn&#8217;t change <strong>web_port</strong> configuration</em>)</li>
</ul>
<p><br/></p>
<p>Using Vagrant, when SSHing into the virtual machine, you will be automatically redirected to the project root directory (<strong>/vagrant</strong>).  To start the application you must run <strong>docker-compose up</strong> which will ensure Docker application containers are up to date.</p>
<p><strong>Git</strong>, <strong>Cloud Foundry Client</strong> with the <strong>Autopilot</strong> and <strong>Service Connect</strong> plugins, <strong>Docker</strong>, and <strong>Docker Compose</strong> come installed on the Vagrant virtual environment initially.  The development environment is meant to bundle tooling necessary to running the Discovery application that might not make sense to install in the containers, and it provides a platform for running isolated Docker clusters in Docker Compose.</p>
<p><br/></p>
</div>
<div class="section" id="common-vagrant-commands">
<span id="common-vagrant-commands"></span><h2>Common Vagrant commands<a class="headerlink" href="#common-vagrant-commands" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Run from the <strong>host</strong> machine</li>
<li>Run from the <strong>top level project</strong> directory</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ vagrant status       <span class="c1"># Check the status of the virtual machine</span>

$ vagrant up           <span class="c1"># Create a new or run an existing virtual machine</span>
$ vagrant provision    <span class="c1"># Re-provision development environment from specs in Vagrantfile</span>
$ vagrant ssh          <span class="c1"># SSH into a running virtual machine</span>

$ vagrant halt         <span class="c1"># Stop and save an existing virtual machine</span>
$ vagrant destroy      <span class="c1"># Completely destroy an existing virtual machine</span>
</pre></div>
</div>
<p>More on the available <a class="reference external" href="https://www.vagrantup.com/docs/cli/">vagrant commands</a></p>
<p><br/></p>
</div>
<div class="section" id="getting-help">
<span id="getting-help"></span><h2>Getting help<a class="headerlink" href="#getting-help" title="Permalink to this headline">¶</a></h2>
<p>If you run into issues please <a class="reference external" href="https://github.com/PSHCDevOps/discovery/issues">file an issue</a> if you can not get them resolved through Vagrant documentation or help channels.  Vagrant has pretty <a class="reference external" href="https://www.vagrantup.com/docs/index.html">comprehensive documentation</a> available and there are plenty of tutorials available covering pretty much all aspects of Vagrant usage.  Being an open source project there is a lot of discussion and question/answers related to Vagrant.</p>
<p>There is a <a class="reference external" href="https://groups.google.com/forum/#!forum/vagrant-up">Vagrant Google group</a> you can join and you can chat with folks about Vagrant on <a class="reference external" href="https://gitter.im/mitchellh/vagrant">Gitter</a>.</p>
<p><br/></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="docker.html" class="btn btn-neutral float-right" title="Discovery on Docker" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="development.html" class="btn btn-neutral" title="Discovery development options" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, GSA Federal Acquisition Service

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'3.0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>